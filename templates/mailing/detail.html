{% extends "base.html" %}
{% block title %}Рассылка №{{ object.id }}{% endblock %}

{% block content %}
<h2>Рассылка №{{ object.id }}</h2>

<div class="card shadow-sm p-4 mb-4">
    <p><strong>Сообщение:</strong> {{ object.message.header }}</p>
    <p><strong>Статус:</strong> {{ object.status }}</p>
    <p><strong>Начало:</strong> {{ object.start }}</p>
    <p><strong>Окончание:</strong> {{ object.end }}</p>

    <h5 class="mt-4">Получатели:</h5>
    <ul>
        {% for r in object.recipients.all %}
            <li>{{ r.email }} — {{ r.full_name }}</li>
        {% endfor %}
    </ul>
</div>

<div class="d-flex gap-2">

    {% if object.owner == user %}
        <a href="{% url 'mailing:mailing_update' object.pk %}" class="btn btn-warning">Изменить</a>
        <a href="{% url 'mailing:mailing_delete' object.pk %}" class="btn btn-danger">Удалить</a>

        <form action="{% url 'mailing:mailing_send' object.pk %}" method="post">
            {% csrf_token %}
            <button type="submit" class="btn btn-primary">Отправить вручную</button>
        </form>
    {% endif %}

    {% if perms.mailing.can_disable_mailing %}
    <form method="post" action="{% url 'mailing:mailing_disable' object.pk %}" style="display:inline;">
        {% csrf_token %}
        <button class="btn btn-outline-danger" onclick="return confirm('Отключить рассылку?');">
            Отключить рассылку
        </button>
    </form>
    {% endif %}

</div>

<hr class="mt-4">

<h4>Статистика попыток</h4>
<ul class="list-group w-50">
    <li class="list-group-item">Успешно: {{ attempts_success }}</li>
    <li class="list-group-item">Неуспешно: {{ attempts_failed }}</li>
    <li class="list-group-item">Всего: {{ attempts_total }}</li>
</ul>

{% endblock %}
